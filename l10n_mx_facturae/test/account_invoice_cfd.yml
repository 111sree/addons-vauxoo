-
  In order to test l10n_mx_facturae CFD Invoice I create an invoice and confirm it with this wizard
-
  !record {model: account.invoice, id: account_invoice_cfd}:
    account_id: account.a_recv
    company_id: base.main_company
    currency_id: base.MXN
    invoice_line:
      - account_id: account.a_sale
        name: '[PCSC234] PC Assemble SC234'
        price_unit: 450.0
        quantity: 1.0
        product_id: product.product_product_3
        uos_id: product.product_uom_unit
    journal_id: l10n_mx_facturae.demo_l10n_mx_facturae_account_journal_0
    partner_id: l10n_mx_partner_address.res_partner_address_vauxoo_1
    reference_type: none
-
  I check that Initially customer invoice state is "Draft"
-
  !assert {model: account.invoice, id: account_invoice_cfd}:
    - state == 'draft'
-
  I called the "Confirm Draft Invoices" wizard
-
  !record {model: account.invoice.confirm, id: account_invoice_confirm_cfd}:
    {}
-
  I clicked on Confirm Invoices Button
-
  !python {model: account.invoice.confirm}: |
    self.invoice_confirm(cr, uid, [ref("account_invoice_confirm_cfd")], {"lang": 'en_US',
      "tz": False, "active_model": "account.invoice", "active_ids": [ref("account_invoice_cfd")],
      "type": "out_invoice", "active_id": ref("account_invoice_cfd"), })
-
  I check that customer invoice state is "Open"
-
  !assert {model: account.invoice, id: account_invoice_cfd}:
    - state == 'open'

-
  I confirm l10n_mx facturae CFD
-
  !python {model: ir.attachment.facturae.mx}: |
    cfd_ids = self.search(cr, uid, [('invoice_id', '=', ref("account_invoice_cfd") )], limit=1)
    cfd = self.browse(cr, uid, cfd_ids)
    self.action_create_ir_attachment_facturae(cr, uid, cfd_ids)

-
  I check that file CFD PDF exists
-
  !python {model: ir.attachment.facturae.mx}: |
    cfd_ids = self.search(cr, uid, [('invoice_id', '=', ref("account_invoice_cfd") )], limit=1)
    cfd = self.browse(cr, uid, cfd_ids)
    attach_id = cfd.file_pdf and cfd.file_pdf.id or False
    assert(attach_id)
