-
  I create a customer invoice with CFD journal
-
  !record {model: account.invoice, id: account_invoice_cfd, view: account.invoice_form}:
    journal_id: l10n_mx_facturae.demo_l10n_mx_facturae_account_journal_0
    partner_id: l10n_mx_partner_address.res_partner_address_vauxoo_1
    payment_term: account.account_payment_term_advance
    reference_type: none
    name: 'Test CFD Customer Invoice'
    invoice_line:
      - product_id: product.product_product_5
        quantity: 10.0
-
  I check that Initially customer invoice state is "Draft"
-
  !assert {model: account.invoice, id: account_invoice_cfd}:
    - state == 'draft'
-
  I called the "Confirm Draft Invoices" wizard
-
  !record {model: account.invoice.confirm, id: account_invoice_confirm_cfd}:
    {}
-
  I clicked on Confirm Invoices Button
-
  !python {model: account.invoice.confirm}: |
    self.invoice_confirm(cr, uid, [ref("account_invoice_confirm_cfd")], {"lang": 'en_US',
      "tz": False, "active_model": "account.invoice", "active_ids": [ref("account_invoice_cfd")],
      "type": "out_invoice", "active_id": ref("account_invoice_cfd"), })
-
  I check that customer invoice state is "Open"
-
  !assert {model: account.invoice, id: account_invoice_cfd}:
    - state == 'open'

-
  I confirm l10n_mx facturae CFD
-
  !python {model: ir.attachment.facturae.mx}: |
    cfd_ids = self.search(cr, uid, [('invoice_id', '=', ref("account_invoice_cfd") )], limit=1)
    cfd = self.browse(cr, uid, cfd_ids)
    self.action_create_ir_attachment_facturae(cr, uid, cfd_ids)

-
  I check that file CFD PDF exists
-
  !python {model: ir.attachment.facturae.mx}: |
    cfd_ids = self.search(cr, uid, [('invoice_id', '=', ref("account_invoice_cfd") )], limit=1)
    cfd = self.browse(cr, uid, cfd_ids)
    attach_id = cfd.file_pdf and cfd.file_pdf.id or False
    assert(attach_id)
