<?xml version="1.0" encoding="UTF-8"?><cfdi:Comprobante xmlns:cfdi="http://www.sat.gob.mx/cfd/3" LugarExpedicion="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.city) + ' ' + o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.state_id.name) + ', ' + o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.country_id.name) }}" Moneda="{{ o.currency_id.name or '' }}" NumCtaPago="{{ o.partner_bank_id.last_acc_number or 'No identificado' }}" TipoCambio="{{ o.rate or 1 }}" certificado="{{ certificado }}" descuento="{{ 0 }}" fecha="{{ o.date_invoice_tz and time.strftime('%Y-%m-%dT%H:%M:%S', time.strptime(o.date_invoice_tz, '%Y-%m-%d %H:%M:%S')) or '' }}" folio="{{ o.number or '' }}" formaDePago="{{ 'Pago en una sola exhibicion' }}" metodoDePago="{{ o.string_to_xml_format(o.pay_method_id.name or 'No identificado') }}" noCertificado="{{ noCertificado }}" sello="" {% if o.journal_id.sequence_id.approval_id.serie %}  serie="{{ o.journal_id.sequence_id.approval_id and o.journal_id.sequence_id.approval_id.serie or '' }}" {% endif %} subTotal="{{ o.amount_untaxed or 0.0 }}" tipoDeComprobante="{{ tipoComprobante }}" total="{{ o.amount_total or 0.0}}" version="3.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd"><cfdi:Emisor nombre="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.name) }}" rfc="{{ o.string_to_xml_format(rfc_emisor) }}"><cfdi:DomicilioFiscal calle="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.street) }}" codigoPostal="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.zip) }}" colonia="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.street2) }}" estado="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.state_id.name) }}" localidad="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_city2) }}" municipio="{{o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.city)}}" noExterior="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_street3) }}" noInterior="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_street4) }}" pais="{{o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.country_id.name)}}"/><cfdi:ExpedidoEn calle="{{ o.string_to_xml_format(o.address_issued_id.street) }}" codigoPostal="{{ o.string_to_xml_format(o.address_issued_id.zip) }}" colonia="{{ o.string_to_xml_format(o.address_issued_id.street2) }}" estado="{{ o.string_to_xml_format(o.address_issued_id.state_id.name) }}" localidad="{{ o.string_to_xml_format(o.address_issued_id.l10n_mx_city2) }}" municipio="{{ o.string_to_xml_format(o.address_issued_id.city) }}" noExterior="{{ o.string_to_xml_format(o.address_issued_id.l10n_mx_street3) }}" noInterior="{{ o.string_to_xml_format(o.address_issued_id.l10n_mx_street4) }}" pais="{{ o.string_to_xml_format(o.address_issued_id.country_id.name) }}"/><cfdi:RegimenFiscal Regimen="{{ o.string_to_xml_format(o.company_emitter_id.partner_id.regimen_fiscal_id.name) or '' }}"/></cfdi:Emisor><cfdi:Receptor nombre="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.name) }}" {% if rfc_receptor %} rfc="{{ o.string_to_xml_format(rfc_receptor.upper()) }}"{% endif %}><cfdi:Domicilio {% if o.partner_id.commercial_partner_id.street %} calle="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.street) }}" {% endif %} {% if o.partner_id.commercial_partner_id.zip %} codigoPostal="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.zip) }}" {% endif %} {% if o.partner_id.commercial_partner_id.street2 %} colonia="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.street2) }}" {% endif %} {% if o.partner_id.commercial_partner_id.state_id.name %} estado="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.state_id.name) }}" {% endif %} {% if o.partner_id.commercial_partner_id.l10n_mx_city2 %} localidad="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.l10n_mx_city2) }}" {% endif %} {% if o.partner_id.commercial_partner_id.city %} municipio="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.city) }}" {% endif %} {% if o.partner_id.commercial_partner_id.l10n_mx_street3 %}noExterior="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.l10n_mx_street3) }}" {% endif %} {% if o.partner_id.commercial_partner_id.l10n_mx_street4 %} noInterior="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.l10n_mx_street4) }}"{% endif %} {% if o.partner_id.commercial_partner_id.country_id.name %} pais="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.country_id.name) }}" {% endif %} /></cfdi:Receptor>{% if o.invoice_line %}<cfdi:Conceptos>{% for i in o.invoice_line %}<cfdi:Concepto cantidad="{{ i.quantity }}" descripcion="{{ o.string_to_xml_format(i.name) }}" importe="{{ i.price_subtotal or 0.0 }}" noIdentificacion="{{ o.string_to_xml_format(i.product_id.default_code) or 'S/N' }}" unidad="{{ i.product_id.uom_id.name }}" valorUnitario="{{ i.price_unit or 0.0 }}"/>{% endfor %}{% endif %}</cfdi:Conceptos><cfdi:Impuestos totalImpuestosTrasladados="{{data_impuestos['totalImpuestosTrasladados'] or 0.0}}" totalImpuestosRetenidos="{{data_impuestos['totalImpuestosRetenidos'] or 0.0}}">{% if o.tax_line %}{%if data_impuestos['Retenciones'] %}<cfdi:Retenciones>{%for tax2 in data_impuestos['Retenciones'] %}<cfdi:Retencion importe="{{ tax2['Retencion']['importe'] or 0.0 }}" impuesto="{{tax2['Retencion']['impuesto'] }}"/>{% endfor %}</cfdi:Retenciones>{% endif %}{%if data_impuestos['Traslados'] %}<cfdi:Traslados>{%for tax in data_impuestos['Traslados'] %}<cfdi:Traslado importe="{{ tax['Traslado']['importe'] or 0.0 }}" impuesto="{{tax['Traslado']['impuesto'] }}" tasa="{{ tax['Traslado']['tasa'] or 0.0 }}"/>{% endfor %}</cfdi:Traslados>{% endif %}{% endif %}</cfdi:Impuestos></cfdi:Comprobante>