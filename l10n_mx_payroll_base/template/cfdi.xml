<?xml version="1.0" encoding="UTF-8"?>
<cfdi:Comprobante xmlns:cfdi="http://www.sat.gob.mx/cfd/3" {% if o.company_emitter_id.address_invoice_parent_company_id.country_id.name and o.company_emitter_id.address_invoice_parent_company_id.state_id.name and o.company_emitter_id.address_invoice_parent_company_id.city %} LugarExpedicion="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.city) + ' ' + o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.state_id.name) + ', ' + o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.country_id.name) }}" {% endif %} {% if o.currency_id.name %} Moneda="{{ o.currency_id.name or '' }}" {% endif %} {% if o.employee_id.bank_account_id.last_acc_number %} NumCtaPago="{{ o.employee_id.bank_account_id.last_acc_number or 'No identificado'}}" {% endif %} {% if o.currency_id.rate %} TipoCambio="{{ '%.2f'%(o.currency_id.rate) }}" {% endif %} {% if certificado %} certificado="{{ certificado }}" {% endif %} descuento="{{ o._get_descuento() }}" fecha="{{ fecha }}" folio="{{ o.number or '' }}" formaDePago="{{ 'Pago en una sola exhibicion' }}" {% if o.pay_method_id.name %} metodoDePago="{{ o.string_to_xml_format(o.pay_method_id.name) or 'No identificado' }}" {% endif %} noCertificado="{{ noCertificado }}" sello="" {% if o.journal_id.sequence_id.approval_id.serie %}  serie="{{ o.journal_id.sequence_id.approval_id and o.journal_id.sequence_id.approval_id.serie or '' }}" {% endif %} subTotal="{{ o.get_input_line_ids_type(o.line_ids, 'P')|sum(attribute='amount') }}" tipoDeComprobante="egreso" total="{{ o.get_input_line_ids_type(o.line_ids, 'P')|sum(attribute='amount') + (o.get_input_line_ids_type(o.line_ids, 'D')|sum(attribute='amount')) }}" version="3.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd">
    <cfdi:Emisor {% if o.company_emitter_id.address_invoice_parent_company_id.name %} nombre="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.name) }}" {% endif %} {% if o.company_emitter_id.address_invoice_parent_company_id.vat_split %} rfc="{{ 'vat_split' in o.company_emitter_id.address_invoice_parent_company_id._columns and o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.vat_split.upper()) or o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.vat.upper()) or ''}}" {% endif %}>
        <cfdi:DomicilioFiscal {% if o.company_emitter_id.address_invoice_parent_company_id.street %} calle="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.street) }}" {% endif %} {% if o.company_emitter_id.address_invoice_parent_company_id.zip %} codigoPostal="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.zip) }}" {% endif %} {% if o.company_emitter_id.address_invoice_parent_company_id.street2 %} colonia="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.street2) }}" {% endif %} {% if o.company_emitter_id.address_invoice_parent_company_id.state_id.name %} estado="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.state_id.name) }}" {% endif %} {% if o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_city2 %} localidad="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_city2) }}" {% endif %} {% if o.company_emitter_id.address_invoice_parent_company_id.city %} municipio="{{o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.city)}}" {% endif %} {% if o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_street3 %} noExterior="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_street3)}}" {% endif %} {% if o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_street4 %} noInterior="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_street4)}}" {% endif %} {% if o.company_emitter_id.address_invoice_parent_company_id.country_id.name %} pais="{{o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.country_id.name)}}" {% endif %}/>
        <cfdi:ExpedidoEn {% if o.address_issued_id.street %} calle="{{ o.string_to_xml_format(o.address_issued_id.street) }}" {% endif %} {% if o.address_issued_id.zip %} codigoPostal="{{ o.string_to_xml_format(o.address_issued_id.zip) }}" {% endif %} {% if o.address_issued_id.street2 %} colonia="{{ o.string_to_xml_format(o.address_issued_id.street2) }}" {% endif %} {% if o.address_issued_id.state_id.name %} estado="{{ o.string_to_xml_format(o.address_issued_id.state_id.name) }}" {% endif %} {% if o.address_issued_id.l10n_mx_city2 %} localidad="{{ o.string_to_xml_format(o.address_issued_id.l10n_mx_city2) }}" {% endif %} {% if o.address_issued_id.city %} municipio="{{ o.string_to_xml_format(o.address_issued_id.city) }}" {% endif %} {% if o.address_issued_id.l10n_mx_street3 %} noExterior="{{ o.string_to_xml_format(o.address_issued_id.l10n_mx_street3) }}" {% endif %} {% if o.address_issued_id.l10n_mx_street4 %} noInterior="{{ o.string_to_xml_format(o.address_issued_id.l10n_mx_street4) }}" {% endif %} {% if o.address_issued_id.country_id.name %} pais="{{  o.string_to_xml_format(o.address_issued_id.country_id.name) }}" {% endif %} />
        <cfdi:RegimenFiscal {% if o.company_emitter_id.partner_id.regimen_fiscal_id.name %} Regimen="{{ o.string_to_xml_format(o.company_emitter_id.partner_id.regimen_fiscal_id.name) or '' }}"{% endif %}/>
    </cfdi:Emisor>
    <cfdi:Receptor nombre="{{ o.string_to_xml_format(o.employee_id.name) }}" {% if o.employee_id.address_home_id.vat_split %} rfc="{{ (o.employee_id.address_home_id._columns.has_key('vat_split') and o.string_to_xml_format(o.employee_id.address_home_id.vat_split.upper()) or o.string_to_xml_format(o.employee_id.address_home_id.vat.upper())) or ''}}" {% endif %}>
        <cfdi:Domicilio {% if o.partner_id.commercial_partner_id.street %} calle="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.street) }}" {% endif %} {% if o.partner_id.commercial_partner_id.zip %} codigoPostal="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.zip) }}" {% endif %} {% if o.partner_id.commercial_partner_id.street2 %} colonia="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.street2) }}" {% endif %} {% if o.partner_id.commercial_partner_id.state_id.name %} estado="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.state_id.name) }}" {% endif %} {% if o.partner_id.commercial_partner_id.l10n_mx_city2 %} localidad="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.l10n_mx_city2) }}" {% endif %} {% if o.partner_id.commercial_partner_id.city %} municipio="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.city) }}" {% endif %} {% if o.partner_id.commercial_partner_id.l10n_mx_street3 %}noExterior="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.l10n_mx_street3) }}" {% endif %} {% if o.partner_id.commercial_partner_id.l10n_mx_street4 %} noInterior="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.l10n_mx_street4) }}"{% endif %} {% if o.partner_id.commercial_partner_id.country_id.name %} pais="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.country_id.name) }}" {% endif %}/>
    </cfdi:Receptor>{% if o.product_id %}
    <cfdi:Conceptos>
        <cfdi:Concepto cantidad="{{ 1 }}" descripcion="{{ o.string_to_xml_format(o.product_id.name) }}" importe="{{ o.get_input_line_ids_type(o.line_ids, 'P')|sum(attribute='amount') }}" noIdentificacion="{{ o.string_to_xml_format(o.product_id.default_code) or 'S/N' }}" unidad="{{ o.string_to_xml_format(o.product_id.uom_id.name) }}" valorUnitario="{{ o.get_input_line_ids_type(o.line_ids, 'P')|sum(attribute='amount') }}"/>
    </cfdi:Conceptos>{% endif %}
    <cfdi:Impuestos totalImpuestosTrasladados="{{data_taxes['totalImpuestosTrasladados'] or 0.0}}" totalImpuestosRetenidos="{{data_taxes['totalImpuestosRetenidos'] or 0.0 }} ">{%if data_taxes['Retenciones'] %}
        <cfdi:Retenciones>{%for tax2 in data_taxes['Retenciones'] %}
            <cfdi:Retencion importe="{{ tax2['Retencion']['importe'] or 0.0 }}" impuesto="{{tax2['Retencion']['impuesto'] }}"/>{% endfor %}
        </cfdi:Retenciones>{% endif %}{%if data_taxes['Traslados'] %}
        <cfdi:Traslados>{%for tax in data_taxes['Traslados'] %}
            <cfdi:Traslado importe="{{ tax['Traslado']['importe'] or 0.0 }}" impuesto="{{tax['Traslado']['impuesto'] }}" tasa="{{ tax['Traslado']['tasa'] or 0.0 }}"/>{% endfor %}
        </cfdi:Traslados>{% endif %}
    </cfdi:Impuestos>
</cfdi:Comprobante>
