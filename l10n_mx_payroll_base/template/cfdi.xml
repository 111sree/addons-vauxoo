<?xml version="1.0" encoding="UTF-8"?><cfdi:Comprobante xmlns:cfdi="http://www.sat.gob.mx/cfd/3" LugarExpedicion="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.city + ' ' + o.company_emitter_id.address_invoice_parent_company_id.state_id.name + ', ' +o.company_emitter_id.address_invoice_parent_company_id.country_id.name) }}" Moneda="{{ o.currency_id.name or '' }}" NumCtaPago="{{ employee.bank_account_id.last_acc_number or 'No identificado' }}" TipoCambio="{{ "%.2f"%(o.currency_id.rate) }}" certificado="{{ certificado }}" descuento="{{ o._get_descuento() }}" fecha="{{ fecha }}" folio="{{ o.number or '' }}" formaDePago="{{ 'Pago en una sola exhibicion' }}" metodoDePago="{{ o.string_to_xml_format(o.pay_method_id.name) or 'No identificado' }}" noCertificado="{{ noCertificado }}" sello="" serie="{{ o.approval_id.serie or 'A' }}" subTotal="{{ o.line_payslip_product_ids |sum(attribute='amount') }}" tipoDeComprobante="egreso" total="{{ (o.line_payslip_product_ids |sum(attribute='amount')) + (o.get_input_line_ids_type(o.line_ids, 'D')|sum(attribute='amount')) }}" version="3.2" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.sat.gob.mx/cfd/3 http://www.sat.gob.mx/sitio_internet/cfd/3/cfdv32.xsd http://www.sat.gob.mx/nomina http://www.sat.gob.mx/sitio_internet/cfd/nomina/nomina11.xsd"><cfdi:Emisor nombre="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.name) }}" rfc="{{  o.string_to_xml_format('vat_split' in o.company_emitter_id.address_invoice_parent_company_id._columns and o.company_emitter_id.address_invoice_parent_company_id.vat_split or o.company_emitter_id.address_invoice_parent_company_id.vat).upper() or ''}}"><cfdi:DomicilioFiscal calle="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.street) }}" codigoPostal="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.zip) }}" colonia="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.street2) }}" estado="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.state_id.name) }}" localidad="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_city2) }}" municipio="{{o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.city)}}" noExterior="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_street3) }}" noInterior="{{ o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.l10n_mx_street4) }}" pais="{{o.string_to_xml_format(o.company_emitter_id.address_invoice_parent_company_id.country_id.name)}}"/><cfdi:ExpedidoEn calle="{{ o.string_to_xml_format(o.address_issued_id.street) }}" codigoPostal="{{ o.string_to_xml_format(o.address_issued_id.zip) }}" colonia="{{ o.string_to_xml_format(o.address_issued_id.street2) }}" estado="{{ o.string_to_xml_format(o.address_issued_id.state_id.name) }}" localidad="{{ o.string_to_xml_format(o.address_issued_id.l10n_mx_city2) }}" municipio="{{ o.string_to_xml_format(o.address_issued_id.city) }}" noExterior="{{ o.string_to_xml_format(o.address_issued_id.l10n_mx_street3) }}" noInterior="{{ o.string_to_xml_format(o.address_issued_id.l10n_mx_street4) }}" pais="{{  o.string_to_xml_format(o.address_issued_id.country_id.name) }}"/><cfdi:RegimenFiscal Regimen="{{ o.string_to_xml_format(o.company_emitter_id.partner_id.regimen_fiscal_id.name) or '' }}"/></cfdi:Emisor><cfdi:Receptor nombre="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.name) }}" rfc="{{ employee.address_home_id._columns.has_key('vat_split') and o.string_to_xml_format(employee.address_home_id.vat_split).upper() or o.string_to_xml_format(employee.address_home_id.vat).upper() or ''}}"><cfdi:Domicilio calle="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.street) }}" codigoPostal="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.zip) }}" colonia="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.street2) }}" estado="{{ o.string_to_xml_format(o.address_issued_id.state_id.name) }}" localidad="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.l10n_mx_city2) }}" municipio="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.city) }}" noExterior="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.l10n_mx_street3) }}" noInterior="{{ o.string_to_xml_format(o.partner_id.commercial_partner_id.l10n_mx_street4) }}" pais="{{ o.string_to_xml_format(employee.address_home_id.country_id.name) }}"/></cfdi:Receptor>{% if o.line_payslip_product_ids %}<cfdi:Conceptos>{% for i in o.line_payslip_product_ids %}<cfdi:Concepto cantidad="{{ 1 }}" descripcion="{{ o.string_to_xml_format(i.product_id.name) }}" importe="{{ i.amount or 0.0 }}" noIdentificacion="{{ i.product_id.default_code or 'S/N' }}" unidad="{{ i.product_id.uom_id.name }}" valorUnitario="{{ i.amount or 0.0 }}"/>{% endfor %}{% endif %}</cfdi:Conceptos><cfdi:Impuestos totalImpuestosTrasladados="{{data_taxes['totalImpuestosTrasladados'] or 0.0}}" totalImpuestosRetenidos="{{data_taxes['totalImpuestosRetenidos'] or 0.0 }} ">{%if data_taxes['Retenciones'] %}<cfdi:Retenciones>{%for tax2 in data_taxes['Retenciones'] %}<cfdi:Retencion importe="{{ tax2['Retencion']['importe'] or 0.0 }}" impuesto="{{tax2['Retencion']['impuesto'] }}"/>{% endfor %}</cfdi:Retenciones>{% endif %}{%if data_taxes['Traslados'] %}<cfdi:Traslados>{%for tax in data_taxes['Traslados'] %}<cfdi:Traslado importe="{{ tax['Traslado']['importe'] or 0.0 }}" impuesto="{{tax['Traslado']['impuesto'] }}" tasa="{{ tax['Traslado']['tasa'] or 0.0 }}"/>{% endfor %}</cfdi:Traslados>{% endif %}</cfdi:Impuestos></cfdi:Comprobante>
