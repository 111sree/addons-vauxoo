<?xml version="1.0"?><nomina:Nomina xmlns:nomina="http://www.sat.gob.mx/nomina" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" Version="1.1" RegistroPatronal="{{ a.string_to_xml_format(employee.employer_registration) }}" NumEmpleado="{{ a.string_to_xml_format(employee.identification_id) or 'S/N' }}" CURP="{{ a.string_to_xml_format(employee.curp and employee.curp.upper()) or 'S/N' }}" TipoRegimen="{{ a.string_to_xml_format(employee.regime_id.code and employee.regime_id.code) or '2' }}" NumSeguridadSocial="{{ a.string_to_xml_format(employee.nss and employee.nss) or 'S/N' }}" FechaPago="{{ time.strftime('%Y-%m-%d') or False }}" FechaInicialPago="{{ a.date_from or False }}" FechaFinalPago="{{ a.date_to or False }}" NumDiasPagados="{{a.worked_days_line_ids|sum(attribute='number_of_days')}}" Departamento="{{ a.string_to_xml_format(employee.department_id.name) }}" CLABE="{{ employee.bank_account_id.clabe and employee.bank_account_id.clabe or '000000000000000000'}}" Banco="{{ a.string_to_xml_format(employee.bank_account_id.bank.code)}}" FechaInicioRelLaboral="{{ a.contract_id.date_start or False }}" Antiguedad="{{ a.seniority or 0 }}" Puesto="{{ a.string_to_xml_format(employee.job_id.name and a.contract_id.job_id.name) or 'N/A' }}" TipoContrato="{{ a.string_to_xml_format(a.contract_id.type_id.name) }}" TipoJornada="{{ a.string_to_xml_format(a.contract_id.working_day_id.name) or '' }}" PeriodicidadPago="{{ a.string_to_xml_format(a.contract_id.schedule_pay) or '' }}" SalarioBaseCotApor="{{ a.contract_id.wage or 0 }}" RiesgoPuesto="{{ a.contract_id.risk_rank_id.code or '1' }}" SalarioDiarioIntegrado="{{ a.contract_id.integrated_salary or 0 }}">{% if a.get_input_line_ids_type(a.input_line_ids, 'perception') %}<nomina:Percepciones TotalGravado="{{ a.get_input_line_ids_type(a.input_line_ids, 'perception')|sum(attribute='amount') }}" TotalExento="{{ a.get_input_line_ids_type(a.input_line_ids, 'perception')|sum(attribute='exempt_amount') }}">{% for i in a.get_input_line_ids_type(a.input_line_ids, 'perception') %}<nomina:Percepcion TipoPercepcion="{{ a.string_to_xml_format(i.salary_rule_id.code) }}" Clave="{{ a.string_to_xml_format(i.salary_rule_id.code + 'clave') }}" Concepto="{{ a.string_to_xml_format(i.salary_rule_id.name) }}" ImporteGravado="{{ i.amount }}" ImporteExento="{{ i.exempt_amount }}"/>{% endfor %}</nomina:Percepciones>{% endif %}{% if a.get_input_line_ids_type(a.input_line_ids, 'deduction')  %}<nomina:Deducciones TotalGravado="{{ a.get_input_line_ids_type(a.input_line_ids, 'deduction')|sum(attribute='amount') }}" TotalExento="{{ a.get_input_line_ids_type(a.input_line_ids, 'deduction')|sum(attribute='exempt_amount') }}">{% for i in a.get_input_line_ids_type(a.input_line_ids, 'deduction') %}<nomina:Deduccion TipoDeduccion="{{ a.string_to_xml_format(i.salary_rule_id.code)  }}" Clave="{{ a.string_to_xml_format(i.salary_rule_id.code + 'clave') }}" Concepto="{{ a.string_to_xml_format(i.salary_rule_id.name)  }}" ImporteGravado="{{ i.amount }}" ImporteExento="{{  i.exempt_amount }}"/>{% endfor %}</nomina:Deducciones>{% endif %}{% if a.inability_line_ids %}<nomina:Incapacidades>{% for i in a.inability_line_ids %}<nomina:Incapacidad DiasIncapacidad="{{ i.number_of_days or 0.0 }}" TipoIncapacidad="{{ i.inability_id.code or 1 }}" Descuento="{{ i.amount or 0 }}"/>{% endfor %}</nomina:Incapacidades>{% endif %}{% if a.overtime_line_ids %}<nomina:HorasExtras>{% for i in a.overtime_line_ids %}<nomina:HorasExtra Dias="{{ i.number_of_days or 0 }}" TipoHoras="{{ a.string_to_xml_format(i.type_hours.replace('double', 'Dobles').replace('triples', 'Triples')) }}" HorasExtra="{{ i.number_of_hours or 0 }}" ImportePagado="{{ i.amount or 0.0 }}"/>{% endfor %}</nomina:HorasExtras>{% endif %}</nomina:Nomina>
